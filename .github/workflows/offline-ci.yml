name: Offline CI

on:
push:
branches: ["main"]
pull_request:
branches: ["main"]

jobs:
test:
runs-on: ubuntu-latest
env:
USE_OFFLINE_WHEELS: "true"
steps:
- uses: actions/checkout@v4

  - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: "3.11"

  - name: Install dependencies
    run: |
      python -m pip install --upgrade pip
      if [ "${USE_OFFLINE_WHEELS}" = "true" ] && [ -d wheelhouse ] && [ "$(ls -A wheelhouse)" ]; then
        python -m pip install --no-index --find-links=wheelhouse -r requirements.txt
      else
        python -m pip install -r requirements.txt
      fi

  - name: Run offline test harness
    run: python scripts/offline_tests.py